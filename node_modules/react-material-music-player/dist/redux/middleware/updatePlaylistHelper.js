"use strict";

Object.defineProperty(exports, "__esModule", {
  value: true
});
exports.default = void 0;
var _actionCreators = _interopRequireDefault(require("../actionCreators.js"));
var _types = require("../types");
function _interopRequireDefault(e) { return e && e.__esModule ? e : { default: e }; }
const updatePlaylistHelper = store => {
  return next => action => {
    if (action.type !== _types.ActionTypes.UPDATE_PLAYLIST) return next(action);

    // store prev playlist and new playlist
    const {
      playlist,
      currentTrack
    } = store.getState();
    const newPlaylist = action.payload.playlist;

    // update state with new playlist
    const result = next(action);

    // check if playlist changed
    let playlistChanged = false;
    if (newPlaylist.length !== playlist.length) playlistChanged = true;else for (let i = 0; i < playlist.length; i++) {
      if (newPlaylist[i]?.ID !== playlist[i]?.ID) {
        playlistChanged = true;
        break;
      }
    }

    // if playlist changed look for current track
    if (playlistChanged) {
      let newCurrentTrack = -1;
      for (let i = 0; i < newPlaylist.length; i++) {
        if (newPlaylist[i]?.ID === playlist[currentTrack]?.ID) {
          newCurrentTrack = i;
          break;
        }
      }

      // if not found then its completely playlist, update current track to 0
      if (newCurrentTrack === -1) store.dispatch(_actionCreators.default.changeTrack(0));else store.dispatch(_actionCreators.default.changeTrack(newCurrentTrack)); // else update current track
    }
    return result;
  };
};
var _default = exports.default = updatePlaylistHelper;